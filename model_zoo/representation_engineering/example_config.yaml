# Representation Engineering Configuration
# Linear Representation Engineering (LRE) for weight modification in latent space

# ============================================================================
# DATASET CONFIGURATION
# ============================================================================
dataset:
  subject_model_dataset: "maximuspowers/muat-pattern-models-v1"
  sample_size: 10  # number of models to modify (null = use all filtered models)
  max_models_subject: 100  # max models to load from dataset (null = load all)
  # optional filtering (applied via get_subject_models):
  # filter_patterns: ["palindrome", "ascending"]  # only models with ALL these patterns
  # exclude_patterns: ["corrupted"]  # exclude models with ANY of these patterns

# ============================================================================
# ENCODER/DECODER CONFIGURATION
# ============================================================================
encoder_decoder:
  encoder_repo_id: "maximuspowers/weight-space-encoder-v1"
  decoder_repo_id: null  # same as encoder if null
  input_mode: "weights"  # "weights", "signature", or "both" (must match encoder training mode)

  # NOTE: tokenizer config and latent_dim are automatically loaded from encoder checkpoint

  # Required if input_mode is "signature" or "both":
  # max_dimensions defines padding size (must match or exceed largest model in dataset)
  # max_dimensions:
  #   max_hidden_layers: 9  # largest model in dataset has 9 hidden layers
  #   max_neurons_per_layer: 40  # largest layer in dataset has 40 neurons
  #
  # neuron_profile defines which features to extract from signatures
  # neuron_profile:
  #   methods: ["mean", "std"]  # select subset of available methods in dataset
  #                              # available: mean, std, max, min, sparsity, entropy, pca, fourier, etc.

# ============================================================================
# STEERING VECTOR CONFIGURATION
# ============================================================================
steering:
  steering_vector_dataset: "maximuspowers/muat-pattern-models-v1"  # dataset used to compute steering vectors
  max_models_steering: null  # null = use all models

  compute_on_init: true
  cache_dir: "steering_vectors_cache"
  normalize_vectors: false
  force_recompute: false
  validate_cache: true

# ============================================================================
# MODIFICATION CONFIGURATION
# ============================================================================
modification:
  strength: 1.0  # steering vector strength (multiplier applied in latent space)

# ============================================================================
# EVALUATION CONFIGURATION
# ============================================================================
evaluation:
  enabled: true
  # benchmark dataset (pre-generated via signature dataset CLI)
  # generate with: python -m model_zoo.cli generate-signature-dataset --output <path> --total-examples 1500
  benchmark_dataset_path: "dataset_generation/benchmarks/eval_benchmark.json"
  batch_size: 32
  # note: vocab_size and sequence_length are inferred from benchmark metadata
  # note: model architectures (num_layers, neurons_per_layer, etc.) are extracted from each model's metadata

# ============================================================================
# LOGGING & OUTPUT
# ============================================================================
run_dir: "results/representation_engineering"  # output directory for this run

logging:
  save_modified_weights: true
  save_steering_vectors: true
  save_evaluation_results: true

# ============================================================================
# HUGGINGFACE DATASET UPLOAD
# ============================================================================
huggingface:
  enabled: false
  repo_id: "username/representation-engineering-results"
  private: false
  token: null  # or use HF_TOKEN env var
  save_local: true

# ============================================================================
# DEVICE CONFIGURATION
# ============================================================================
device:
  type: "auto"  # 'auto', 'cuda', 'mps', 'cpu'
